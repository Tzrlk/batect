



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for batect, the build and testing environments as code tool">
      
      
        <link rel="canonical" href="https://batect.dev/tips/Performance.html">
      
      
        <meta name="author" content="Charles Korn">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Performance - batect documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../assets/3rdparty/asciinema-player.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-63947227-2", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#performance" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://batect.dev" title="batect documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              batect documentation
            </span>
            <span class="md-header-nav__topic">
              
                Performance
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/batect/batect/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    batect/batect
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://batect.dev" title="batect documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    batect documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/batect/batect/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    batect/batect
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../QuickStart.html" title="Quick start" class="md-nav__link">
      Quick start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GettingStarted.html" title="Getting started tutorial" class="md-nav__link">
      Getting started tutorial
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Comparison.html" title="Comparison with other tools" class="md-nav__link">
      Comparison with other tools
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Configuration file reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Configuration file reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/Overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/ConfigVariables.html" title="Config Variables" class="md-nav__link">
      Config Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/Containers.html" title="Containers" class="md-nav__link">
      Containers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/Tasks.html" title="Tasks" class="md-nav__link">
      Tasks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CLIReference.html" title="CLI reference" class="md-nav__link">
      CLI reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../TaskLifecycle.html" title="Task lifecycle" class="md-nav__link">
      Task lifecycle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Language and tool-specific information
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Language and tool-specific information
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/CircleCI.html" title="CircleCI" class="md-nav__link">
      CircleCI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Docker.html" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/GitHubActions.html" title="GitHub Actions" class="md-nav__link">
      GitHub Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Golang.html" title="Golang" class="md-nav__link">
      Golang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Java.html" title="Java" class="md-nav__link">
      Java
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Node.html" title="Node.js" class="md-nav__link">
      Node.js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Ruby.html" title="Ruby" class="md-nav__link">
      Ruby
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/TravisCI.html" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      Tips and tricks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Tips and tricks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="CISetup.html" title="CI setup" class="md-nav__link">
      CI setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="IDEIntegration.html" title="IDE integration" class="md-nav__link">
      IDE integration
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Performance
      </label>
    
    <a href="Performance.html" title="Performance" class="md-nav__link md-nav__link--active">
      Performance
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#io-performance" class="md-nav__link">
    I/O performance
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-volumes" class="md-nav__link">
    Cache volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounts-in-cached-mode" class="md-nav__link">
    Mounts in cached mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-and-test-data" class="md-nav__link">
    Database schema and test data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutdown-time" class="md-nav__link">
    Shutdown time
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="BuildArtifactsOwnedByRoot.html" title="Build artifacts are owned by root" class="md-nav__link">
      Build artifacts are owned by root
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="WaitingForDependenciesToBeReady.html" title="Waiting for dependencies to be ready" class="md-nav__link">
      Waiting for dependencies to be ready
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="Proxies.html" title="Proxies" class="md-nav__link">
      Proxies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="Windows.html" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SampleProjects.html" title="Sample projects" class="md-nav__link">
      Sample projects
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/batect/batect/releases" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/batect/batect/blob/master/ROADMAP.md" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#io-performance" class="md-nav__link">
    I/O performance
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cache-volumes" class="md-nav__link">
    Cache volumes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mounts-in-cached-mode" class="md-nav__link">
    Mounts in cached mode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#database-schema-and-test-data" class="md-nav__link">
    Database schema and test data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shutdown-time" class="md-nav__link">
    Shutdown time
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/batect/batect/edit/master/docs/content/tips/Performance.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="performance">Performance<a class="headerlink" href="#performance" title="Permanent link">&para;</a></h1>
<h2 id="io-performance">I/O performance<a class="headerlink" href="#io-performance" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">tl;dr</p>
<p>If you're seeing slow build times under batect on macOS or Windows, using batect's caches as well as volume mount options such as <code>cached</code> might help</p>
</div>
<p>Docker requires features only found in the Linux kernel, and so on macOS and Windows, Docker Desktop runs a lightweight Linux virtual machine
to host Docker. However, while this works perfectly fine for most situations, there is some overhead involved in operations
that need to work across the host / virtual machine boundary, particularly when it comes to mounting files or directories into a container from the host.</p>
<p>While the throughput of mounts on macOS and Windows is generally comparable to native file access within a container, the latency
performing I/O operations such as opening a file handle can often be significant, as these need to cross from the Linux VM hosting Docker to the
host OS and back again.</p>
<p>This increased latency quickly accumulates, especially when many file operations are involved. This particularly affects languages such as JavaScript
and Golang that encourage distributing all dependencies as source code and breaking codebases into many small files, as even a warm build with no source
code changes still requires the compiler to examine each dependency file to ensure that the cached build result is up-to-date.</p>
<p>There are two ways to improve the performance of file I/O when using batect:</p>
<ul>
<li>Use <a href="#cache-volumes">a batect cache backed by a Docker volume</a> wherever possible</li>
<li>Otherwise, use <a href="#mounts-in-cached-mode">the <code>cached</code> mount mode</a></li>
</ul>
<h3 id="cache-volumes">Cache volumes<a class="headerlink" href="#cache-volumes" title="Permanent link">&para;</a></h3>
<p>The performance penalty of mounting a file or directory from the host machine does not apply to <a href="https://docs.docker.com/storage/volumes/">Docker volumes</a>,
as these remain entirely on the Linux VM hosting Docker. This makes them perfect for directories such as caches where persistence between task runs is required,
but easy access to their contents is not necessary.</p>
<p>batect makes this simple to configure. In your container definition, add a mount to <a href="../config/Containers.html#volumes"><code>volumes</code></a> with <code>type: cache</code>.</p>
<p>For example, for a typical Node.js application, to cache the <code>node_modules</code> directory in a volume, include the following in your configuration:</p>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;node:13.8.0&quot;</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cache</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">app-node-modules</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code/node_modules</span>
    <span class="nt">working_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
</pre></div>

<p>If you are using cache volumes with <a href="BuildArtifactsOwnedByRoot.html">run as current user mode</a> enabled, you must use a Dockerfile built by batect for the container and add
the following to that Dockerfile to ensure that the container can read and write to caches:</p>
<div class="codehilite"><pre><span></span><span class="k">ARG</span> batect_cache_setup_command
<span class="k">RUN</span> sh -c <span class="s2">&quot;</span><span class="nv">$batect_cache_setup_command</span><span class="s2">&quot;</span>
</pre></div>

<p>batect uses the <code>batect_cache_setup_command</code> build arg to create the target directories of any caches and ensure that they have the correct permissions set. This must be done
at image build time due to limitations in Docker's support for using volumes with different users.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To make it easier to share caches between builds on ephemeral CI agents, you can use directories mounted from the project's <code>.batect/caches</code> directory
instead of volumes and then archive this directory between builds. Run batect with <code>--cache-type=directory</code> to enable this behaviour.</p>
<p>Using mounted directories instead of volumes has no performance impact on Linux.</p>
</div>
<h3 id="mounts-in-cached-mode">Mounts in <code>cached</code> mode<a class="headerlink" href="#mounts-in-cached-mode" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This section only applies to macOS-based hosts, and is only supported by Docker version 17.04 and higher.
Enabling <code>cached</code> mode is harmless for other host operating systems.</p>
</div>
<p>For situations where a cache is not appropriate (eg. mounting your code from the host into a build environment), specifying the <code>cached</code> volume mount option
can result in significant performance improvements.</p>
<p>(Before you use this option in another context, you should consult the <a href="https://docs.docker.com/docker-for-mac/osxfs-caching/">documentation</a> to understand the implications of it.)</p>
<p>For example, instead of defining your container like this:</p>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;ruby:2.4.3&quot;</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
    <span class="nt">working_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
</pre></div>

<p>use this:</p>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;ruby:2.4.3&quot;</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
        <span class="nt">options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cached</span> <span class="c1"># This enables &#39;cached&#39; mode for the /code mount</span>
    <span class="nt">working_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
</pre></div>

<p>Setting this option will not affect Linux or Windows hosts, so it's safe to commit and share this in a project where some developers use
macOS and others use Linux or Windows.</p>
<h2 id="database-schema-and-test-data">Database schema and test data<a class="headerlink" href="#database-schema-and-test-data" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">tl;dr</p>
<p>Try to do as much work as possible at image build time, rather than doing it every time the container starts</p>
</div>
<p>A significant amount of time during integration or journey testing with a database can be taken up by preparing the database for
use - setting up the schema (usually with some kind of migrations system) and adding the initial test data can take quite some time,
especially as the application evolves over time.</p>
<p>One way to address this is to bake the schema and test data into the Docker image used for the database, so that this setup cost only
has to be paid when building the image or when the setup changes, rather than on every test run. The exact method for doing this will
vary depending on the database system you're using, but the general steps that would go in your Dockerfile are:</p>
<ol>
<li>Copy schema and test data scripts into container</li>
<li>Temporarily start database daemon</li>
<li>Run schema and data scripts against database instance</li>
<li>Shut down database daemon</li>
</ol>
<h2 id="shutdown-time">Shutdown time<a class="headerlink" href="#shutdown-time" title="Permanent link">&para;</a></h2>
<div class="admonition tip">
<p class="admonition-title">tl;dr</p>
<p>Make sure signals such as SIGTERM and SIGKILL are being passed to the main process</p>
</div>
<p>If you notice that post-task cleanup for a container is taking longer than expected, and that container starts the main process from a
shell script, make sure that signals such as SIGTERM and SIGKILL are being forwarded to the process. (Otherwise Docker will wait 10
seconds for the application to respond to the signal before just terminating the process.)</p>
<p>For example, instead of using:</p>
<div class="codehilite"><pre><span></span><span class="ch">#! /usr/bin/env bash</span>

/app/my-really-cool-app --do-stuff
</pre></div>

<p>use this:</p>
<div class="codehilite"><pre><span></span><span class="ch">#! /usr/bin/env bash</span>

<span class="nb">exec</span> /app/my-really-cool-app --do-stuff
</pre></div>

<p>(<a href="https://unix.stackexchange.com/a/196053/258093">source</a>)</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="IDEIntegration.html" title="IDE integration" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                IDE integration
              </span>
            </div>
          </a>
        
        
          <a href="BuildArtifactsOwnedByRoot.html" title="Build artifacts are owned by root" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Build artifacts are owned by root
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2020 Charles Korn.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/batect/batect" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://spectrum.chat/batect" class="md-footer-social__link fa fa-comments"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../assets/3rdparty/asciinema-player.js"></script>
      
    
  </body>
</html>
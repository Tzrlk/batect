



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for batect, the build and testing environments as code tool">
      
      
        <link rel="canonical" href="https://batect.dev/config/Containers.html">
      
      
        <meta name="author" content="Charles Korn">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.0">
    
    
      
        <title>Containers - batect documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.1b62728e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#2196f3">
      
    
    
      <script src="../assets/javascripts/modernizr.268332fc.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../assets/3rdparty/asciinema-player.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-63947227-2", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#container-definitions" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://batect.dev" title="batect documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              batect documentation
            </span>
            <span class="md-header-nav__topic">
              
                Containers
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/batect/batect/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    batect/batect
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://batect.dev" title="batect documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    batect documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/batect/batect/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    batect/batect
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../index.html" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../QuickStart.html" title="Quick start" class="md-nav__link">
      Quick start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../GettingStarted.html" title="Getting started tutorial" class="md-nav__link">
      Getting started tutorial
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../Comparison.html" title="Comparison with other tools" class="md-nav__link">
      Comparison with other tools
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Configuration file reference
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Configuration file reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="Overview.html" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="ConfigVariables.html" title="Config Variables" class="md-nav__link">
      Config Variables
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Containers
      </label>
    
    <a href="Containers.html" title="Containers" class="md-nav__link md-nav__link--active">
      Containers
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image" class="md-nav__link">
    image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_directory" class="md-nav__link">
    build_directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_args" class="md-nav__link">
    build_args
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    dockerfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command" class="md-nav__link">
    command
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entrypoint" class="md-nav__link">
    entrypoint
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    environment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#term" class="md-nav__link">
    TERM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-related-environment-variables" class="md-nav__link">
    Proxy-related environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working_directory" class="md-nav__link">
    working_directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    volumes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-mounts" class="md-nav__link">
    Local mounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-mounts" class="md-nav__link">
    Cache mounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devices" class="md-nav__link">
    devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    ports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health_check" class="md-nav__link">
    health_check
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_as_current_user" class="md-nav__link">
    run_as_current_user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup_commands" class="md-nav__link">
    setup_commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privileged" class="md-nav__link">
    privileged
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capabilities_to_add-and-capabilities_to_drop" class="md-nav__link">
    capabilities_to_add and capabilities_to_drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable_init_process" class="md-nav__link">
    enable_init_process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional_hostnames" class="md-nav__link">
    additional_hostnames
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimal-configuration-with-existing-image" class="md-nav__link">
    Minimal configuration with existing image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-configuration-with-dockerfile" class="md-nav__link">
    Minimal configuration with Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-custom-command" class="md-nav__link">
    Container with custom command
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-environment-variables" class="md-nav__link">
    Container with environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-working-directory" class="md-nav__link">
    Container with working directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-volume-mounts" class="md-nav__link">
    Container with volume mounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-ports" class="md-nav__link">
    Container with ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-dependencies" class="md-nav__link">
    Container with dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-as-the-current-user" class="md-nav__link">
    Container that runs as the current user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-with-dockers-default-init-process-enabled" class="md-nav__link">
    Container that runs with Docker's default init process enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-a-setup-command-after-starting" class="md-nav__link">
    Container that runs a setup command after starting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="Tasks.html" title="Tasks" class="md-nav__link">
      Tasks
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../CLIReference.html" title="CLI reference" class="md-nav__link">
      CLI reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../TaskLifecycle.html" title="Task lifecycle" class="md-nav__link">
      Task lifecycle
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Language and tool-specific information
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Language and tool-specific information
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/DotNetCore.html" title=".NET Core" class="md-nav__link">
      .NET Core
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/CircleCI.html" title="CircleCI" class="md-nav__link">
      CircleCI
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Docker.html" title="Docker" class="md-nav__link">
      Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/GitHubActions.html" title="GitHub Actions" class="md-nav__link">
      GitHub Actions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Golang.html" title="Golang" class="md-nav__link">
      Golang
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Gradle.html" title="Gradle" class="md-nav__link">
      Gradle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Node.html" title="Node.js" class="md-nav__link">
      Node.js
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/Ruby.html" title="Ruby" class="md-nav__link">
      Ruby
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tools/TravisCI.html" title="Travis CI" class="md-nav__link">
      Travis CI
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Tips and tricks
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Tips and tricks
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/CISetup.html" title="CI setup" class="md-nav__link">
      CI setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/IDEIntegration.html" title="IDE integration" class="md-nav__link">
      IDE integration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/Performance.html" title="Performance" class="md-nav__link">
      Performance
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/BuildArtifactsOwnedByRoot.html" title="Build artifacts are owned by root" class="md-nav__link">
      Build artifacts are owned by root
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/WaitingForDependenciesToBeReady.html" title="Waiting for dependencies to be ready" class="md-nav__link">
      Waiting for dependencies to be ready
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/Proxies.html" title="Proxies" class="md-nav__link">
      Proxies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tips/Windows.html" title="Windows" class="md-nav__link">
      Windows
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../SampleProjects.html" title="Sample projects" class="md-nav__link">
      Sample projects
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/batect/batect/releases" title="Release notes" class="md-nav__link">
      Release notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://github.com/batect/batect/blob/master/ROADMAP.md" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#image" class="md-nav__link">
    image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_directory" class="md-nav__link">
    build_directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build_args" class="md-nav__link">
    build_args
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dockerfile" class="md-nav__link">
    dockerfile
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#command" class="md-nav__link">
    command
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#entrypoint" class="md-nav__link">
    entrypoint
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#environment" class="md-nav__link">
    environment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#term" class="md-nav__link">
    TERM
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proxy-related-environment-variables" class="md-nav__link">
    Proxy-related environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#working_directory" class="md-nav__link">
    working_directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#volumes" class="md-nav__link">
    volumes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#local-mounts" class="md-nav__link">
    Local mounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-mounts" class="md-nav__link">
    Cache mounts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#devices" class="md-nav__link">
    devices
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ports" class="md-nav__link">
    ports
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#health_check" class="md-nav__link">
    health_check
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_as_current_user" class="md-nav__link">
    run_as_current_user
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup_commands" class="md-nav__link">
    setup_commands
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#privileged" class="md-nav__link">
    privileged
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#capabilities_to_add-and-capabilities_to_drop" class="md-nav__link">
    capabilities_to_add and capabilities_to_drop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#enable_init_process" class="md-nav__link">
    enable_init_process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional_hostnames" class="md-nav__link">
    additional_hostnames
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#minimal-configuration-with-existing-image" class="md-nav__link">
    Minimal configuration with existing image
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minimal-configuration-with-dockerfile" class="md-nav__link">
    Minimal configuration with Dockerfile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-custom-command" class="md-nav__link">
    Container with custom command
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-environment-variables" class="md-nav__link">
    Container with environment variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-working-directory" class="md-nav__link">
    Container with working directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-volume-mounts" class="md-nav__link">
    Container with volume mounts
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-ports" class="md-nav__link">
    Container with ports
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-with-dependencies" class="md-nav__link">
    Container with dependencies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-as-the-current-user" class="md-nav__link">
    Container that runs as the current user
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-with-dockers-default-init-process-enabled" class="md-nav__link">
    Container that runs with Docker's default init process enabled
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#container-that-runs-a-setup-command-after-starting" class="md-nav__link">
    Container that runs a setup command after starting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/batect/batect/edit/master/docs/content/config/Containers.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="container-definitions">Container definitions<a class="headerlink" href="#container-definitions" title="Permanent link">&para;</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page reflects the options available in the <a href="https://github.com/batect/batect/releases/latest">most recent version</a>
of batect.</p>
</div>
<p>Each container definition is made up of:</p>
<h2 id="image"><code>image</code><a class="headerlink" href="#image" title="Permanent link">&para;</a></h2>
<p>Image name (in standard Docker image reference format) to use for this container. <strong>One of <code>image</code> or <code>build_directory</code> is required.</strong></p>
<p>The image can be overridden when running a task with <a href="../CLIReference.html#override-the-image-used-by-a-container-override-image"><code>--override-image</code></a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is highly recommended that you specify a specific image version, and not use <code>latest</code>, to ensure that the same image is used
everywhere. For example, use <code>alpine:3.7</code>, not <code>alpine</code> or <code>alpine:latest</code>.</p>
</div>
<h2 id="build_directory"><code>build_directory</code><a class="headerlink" href="#build_directory" title="Permanent link">&para;</a></h2>
<p>Path (relative to the configuration file's directory) to a directory containing a Dockerfile to build and use as an image for this container.
<strong>One of <code>image</code> or <code>build_directory</code> is required.</strong></p>
<p>On Windows, <code>build_directory</code> can use either Windows-style (<code>path\to\thing</code>) or Unix-style (<code>path/to/thing</code>) paths, but for compatibility
with users running on other operating systems, using Unix-style paths is recommended.</p>
<p>The image can be overridden when running a task with <a href="../CLIReference.html#override-the-image-used-by-a-container-override-image"><code>--override-image</code></a>.</p>
<h2 id="build_args"><code>build_args</code><a class="headerlink" href="#build_args" title="Permanent link">&para;</a></h2>
<p>List of build args (in <code>name: value</code> format) to use when building the image in <a href="#build_directory"><code>build_directory</code></a>. Values can be <a href="Overview.html#expressions">expressions</a>.</p>
<p>Each build arg must be defined in the Dockerfile with an <code>ARG</code> instruction otherwise the value provided will have no effect.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Use caution when using build args for secret values. Build arg values can be revealed by anyone with a copy of the image with the <code>docker history</code> command.</p>
</div>
<h2 id="dockerfile"><code>dockerfile</code><a class="headerlink" href="#dockerfile" title="Permanent link">&para;</a></h2>
<p>Dockerfile (relative to <a href="#build_directory"><code>build_directory</code></a>) to use when building the image in <a href="#build_directory"><code>build_directory</code></a>. Defaults to <code>Dockerfile</code> if not set.</p>
<p>The Dockerfile must be within <a href="#build_directory"><code>build_directory</code></a>.</p>
<p><code>dockerfile</code> must always be specified with Unix-style (<code>path/to/thing</code>) paths, even when running on Windows.</p>
<h2 id="command"><code>command</code><a class="headerlink" href="#command" title="Permanent link">&para;</a></h2>
<p>Command to run when the container starts.</p>
<p>If not provided, the default command for the image will be run.</p>
<p>Both of these can be overridden for an individual task by specifying a <a href="Tasks.html#run"><code>command</code> at the task level</a>.</p>
<p><a name="command-entrypoint-note"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Keep in mind that this command is passed to the image's <code>ENTRYPOINT</code>, just like it would when using <code>docker run &lt;image&gt; &lt;command&gt;</code>
directly.</p>
<p>This means that if the entrypoint is not set or is not a shell, standard shell syntax features like <code>$MY_ENVIRONMENT_VARIABLE</code> and <code>&amp;&amp;</code> might not work.</p>
<p>See the Docker docs for <a href="https://docs.docker.com/engine/reference/builder/#cmd"><code>CMD</code></a> and
<a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a> for more details.</p>
<p>If you would like to use shell syntax features in your command, you have four options:</p>
<ol>
<li>
<p>Create a shell script and invoke that instead of specifying the command directly.</p>
</li>
<li>
<p>Wrap your command in a shell invocation.</p>
<p>For example, if your command is <code>echo hello &amp;&amp; echo world</code>, set <code>command</code> to <code>sh -c 'echo hello &amp;&amp; echo world'</code>.</p>
</li>
<li>
<p>Set the entrypoint in the image to a shell. For example:
   <div class="codehilite"><pre><span></span><span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/bin/sh&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">]</span>
</pre></div></p>
</li>
<li>
<p>Set the <a href="#entrypoint">entrypoint</a> for the container to a shell. For example:
   <div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">container-1</span><span class="p">:</span>
    <span class="nt">command</span><span class="p">:</span> <span class="s">&quot;&#39;echo</span><span class="nv"> </span><span class="s">hello</span><span class="nv"> </span><span class="s">&amp;&amp;</span><span class="nv"> </span><span class="s">echo</span><span class="nv"> </span><span class="s">world&#39;&quot;</span> <span class="c1"># Single quotes so that whole command is treated as a single argument when passed to sh, double quotes so that YAML preserves the single quotes</span>
    <span class="nt">entrypoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/bin/sh -c</span>
</pre></div></p>
</li>
</ol>
<p>Note that for both options 3 and 4, you must quote the command so that it is passed to <code>sh -c</code> as a single argument (we want the final command line to be <code>sh -c 'echo hello &amp;&amp; echo world'</code>, not
<code>sh -c echo hello &amp;&amp; echo world</code>).</p>
</div>
<h2 id="entrypoint"><code>entrypoint</code><a class="headerlink" href="#entrypoint" title="Permanent link">&para;</a></h2>
<p>Entrypoint to use to run the <a href="#command">command</a>.</p>
<p>If not provided, the default entrypoint for the container will be used.</p>
<p>Both of these can be overridden for an individual task by specifying an <a href="Tasks.html#entrypoint"><code>entrypoint</code> at the task level</a>.</p>
<p>See the Docker docs for <a href="https://docs.docker.com/engine/reference/builder/#cmd"><code>CMD</code></a> and
<a href="https://docs.docker.com/engine/reference/builder/#entrypoint"><code>ENTRYPOINT</code></a> for more information on how the entrypoint is used.
batect will always convert the entrypoint provided here to the exec form when passed to Docker.</p>
<h2 id="environment"><code>environment</code><a class="headerlink" href="#environment" title="Permanent link">&para;</a></h2>
<p>List of environment variables (in <code>name: value</code> format) for the container. Values can be <a href="Overview.html#expressions">expressions</a>.</p>
<h3 id="term"><code>TERM</code><a class="headerlink" href="#term" title="Permanent link">&para;</a></h3>
<p>The <code>TERM</code> environment variable, if set on the host, is always automatically passed through to the container. This ensures that features such as
coloured output continue to work correctly inside the container.</p>
<h3 id="proxy-related-environment-variables">Proxy-related environment variables<a class="headerlink" href="#proxy-related-environment-variables" title="Permanent link">&para;</a></h3>
<p>Proxy-related environment variables, if set on the host, are passed through to the container at build and run time, but are not used for image pulls.</p>
<p>If a proxy-related environment variable is defined on the container's configuration, it takes precedence over the host-provided value.</p>
<p>See <a href="../tips/Proxies.html">this page</a> for more information on using batect with proxies.</p>
<h2 id="working_directory"><code>working_directory</code><a class="headerlink" href="#working_directory" title="Permanent link">&para;</a></h2>
<p>Working directory to start the container in.</p>
<p>If not provided, the default working directory for the image will be used.</p>
<p>Both of these can be overridden for an individual task by specifying a <a href="Tasks.html#run"><code>working_directory</code> at the task level</a>.</p>
<h2 id="volumes"><code>volumes</code><a class="headerlink" href="#volumes" title="Permanent link">&para;</a></h2>
<p>List of volume mounts to create for the container.</p>
<p>Both local mounts (mounting a directory on the host into a container) and <a href="../tips/Performance.html#cache-volumes">cache mounts</a> are supported:</p>
<h3 id="local-mounts">Local mounts<a class="headerlink" href="#local-mounts" title="Permanent link">&para;</a></h3>
<p>Two formats are supported:</p>
<ul>
<li>
<p>Standard Docker <code>local:container</code> or <code>local:container:options</code> format</p>
</li>
<li>
<p>An expanded format:</p>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">my-container</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="c1"># This is equivalent to .:/code:cached</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
        <span class="nt">options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cached</span>
</pre></div>

</li>
</ul>
<p>In both formats, the following fields are supported:</p>
<ul>
<li>
<p><code>local</code>: path to the local file or directory to mount. Can be an <a href="Overview.html#expressions">expression</a> when using the expanded format. Required.</p>
<p>Relative paths will be resolved relative to the configuration file's directory.</p>
<p>On Windows, the local path can use either Windows-style (<code>path\to\thing</code>) or Unix-style (<code>path/to/thing</code>) paths, but for compatibility
with users running on other operating systems, using Unix-style paths is recommended.</p>
</li>
<li>
<p><code>container</code>: path to mount the local file or directory at inside the container. Required.</p>
</li>
<li><code>options</code>: standard Docker mount options (such as <code>ro</code> for read-only). Optional.</li>
</ul>
<p>Using <code>options: cached</code> may improve performance when running on macOS hosts - see <a href="../tips/Performance.html#io-performance">this page</a> for further explanation.</p>
<h3 id="cache-mounts">Cache mounts<a class="headerlink" href="#cache-mounts" title="Permanent link">&para;</a></h3>
<p>Cache mounts provide persistence between task runs without the performance overhead of mounting a directory from the host into the container.</p>
<p>They are perfect for directories such as <code>node_modules</code> which contain downloaded dependencies that can safely be reused for each task run.</p>
<p>The format for a cache mount is:</p>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">my-container</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">volumes</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cache</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node-modules</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code/node_modules</span>
</pre></div>

<p>The following fields are supported:</p>
<ul>
<li><code>type</code>: must be set to <code>cache</code>. Required.</li>
<li><code>name</code>: name of the cache, must be a valid Docker volume name. The same name can be used to share a cache between multiple containers. Required.</li>
<li><code>container</code>: path to mount the cache directory at inside the container. Required.</li>
<li><code>options</code>: standard Docker mount options (such as <code>ro</code> for read-only). Optional.</li>
</ul>
<p>If <a href="#run_as_current_user">run as current user mode</a> is enabled, you must use a Dockerfile built by batect for the container and add the following to that
Dockerfile to ensure that the container can read and write to caches:</p>
<div class="codehilite"><pre><span></span><span class="k">ARG</span> batect_cache_setup_command
<span class="k">RUN</span> sh -c <span class="s2">&quot;</span><span class="nv">$batect_cache_setup_command</span><span class="s2">&quot;</span>
</pre></div>

<p>batect uses the <code>batect_cache_setup_command</code> build arg to create the target directories of any caches and ensure that they have the correct permissions set. This must be done
at image build time due to limitations in Docker's support for using volumes with different users.</p>
<h2 id="devices"><code>devices</code><a class="headerlink" href="#devices" title="Permanent link">&para;</a></h2>
<p>List of device mounts to create for the container.</p>
<p>Two formats are supported:</p>
<ul>
<li>
<p>Standard Docker <code>local:container</code> or <code>local:container:options</code> format</p>
</li>
<li>
<p>An expanded format:
  <div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">my-container</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">devices</span><span class="p p-Indicator">:</span>
    <span class="c1"># This is equivalent to /dev/sda:/dev/disk:r</span>
    <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/sda</span>
      <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/disk</span>
      <span class="nt">options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">r</span>
</pre></div></p>
</li>
</ul>
<p>Note that the <code>local</code> device mounts will be different for Windows and Unix-like hosts. See the <a href="https://docs.docker.com/engine/reference/commandline/run/#add-host-device-to-container---device">Docker guide for adding host devices to containers</a> for more information.</p>
<h2 id="ports"><code>ports</code><a class="headerlink" href="#ports" title="Permanent link">&para;</a></h2>
<p>List of ports to make available to the host machine.</p>
<p>Only TCP ports are supported at present.</p>
<p>Note that this does not affect how containers launched by batect as part of the same task access ports used by each other. Any container started as part of a
task will be able to access any port on any other container at the address <code>container_name:container_port</code>. For example, if a process running in the <code>http-server</code>
container listens on port 2000, any other container in the task can access that at <code>http-server:2000</code> without port 2000 being listed in <code>ports</code> (or an <code>EXPOSE</code>
Dockerfile instruction).</p>
<p>Two formats are supported:</p>
<ul>
<li>
<p>Standard Docker <code>local:container</code> format. For example, <code>1234:5678</code> will make port 5678 inside the container available on the host machine at port 1234.</p>
</li>
<li>
<p>An expanded format:
  <div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">my-container</span><span class="p">:</span>
    <span class="l l-Scalar l-Scalar-Plain">...</span>
    <span class="l l-Scalar l-Scalar-Plain">ports</span><span class="p p-Indicator">:</span>
      <span class="c1"># This is equivalent to 1234:5678</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1234</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5678</span>
</pre></div></p>
</li>
</ul>
<h2 id="dependencies"><code>dependencies</code><a class="headerlink" href="#dependencies" title="Permanent link">&para;</a></h2>
<p>List of other containers that should be started and healthy before starting this container.</p>
<p>If a dependency's image does not contain a <a href="https://docs.docker.com/engine/reference/builder/#healthcheck">health check</a>, then as soon as it has started,
it is considered to be healthy.</p>
<p>See <a href="../tips/WaitingForDependenciesToBeReady.html">this page</a> for more information on how to ensure dependencies are ready before starting containers that
depend on them.</p>
<h2 id="health_check"><code>health_check</code><a class="headerlink" href="#health_check" title="Permanent link">&para;</a></h2>
<p>Overrides <a href="https://docs.docker.com/engine/reference/builder/#healthcheck">health check</a> configuration specified in the image or Dockerfile:</p>
<ul>
<li>
<p><code>command</code> The command to run to check the health of the container. If this command exits with code 0, the container is considered healthy, otherwise
  the container is considered unhealthy. If not provided, the default command specified in the image or Dockerfile is used.</p>
</li>
<li>
<p><code>retries</code> The number of times to perform the health check before considering the container unhealthy.</p>
</li>
<li>
<p><code>interval</code> The interval between runs of the health check. Accepts values such as <code>2s</code> (two seconds) or <code>1m</code> (one minute).</p>
</li>
<li>
<p><code>start_period</code> The time to wait before failing health checks count against the retry count. The health check is still run during this period,
  and if the check succeeds, the container is immediately considered healthy. Accepts values such as <code>2s</code> (two seconds) or <code>1m</code> (one minute).</p>
</li>
</ul>
<h2 id="run_as_current_user"><code>run_as_current_user</code><a class="headerlink" href="#run_as_current_user" title="Permanent link">&para;</a></h2>
<p>Run the container with the same UID and GID as the user running batect (rather than the user the Docker daemon runs as, which is root
on Linux). This means that any files created by the container will be owned by the user running batect, rather than root.</p>
<p>This is really only useful on Linux. On macOS, the Docker daemon runs as the currently logged-in user and so any files created in the container are owned
by that user, so this is less of an issue. However, for consistency, the same configuration changes are made on both Linux and macOS.</p>
<p><code>run_as_current_user</code> has the following options:</p>
<ul>
<li>
<p><code>enabled</code> Defaults to <code>false</code>, set to <code>true</code> to enable 'run as current user' mode.</p>
</li>
<li>
<p><code>home_directory</code> Directory to use as home directory for user inside container. Required if <code>enabled</code> is <code>true</code>, not allowed if <code>enabled</code> is not provided
  or set to <code>false</code>.</p>
</li>
</ul>
<p>This directory is automatically created by batect with the correct owner and group.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the directory given by <code>home_directory</code> already exists inside the image for this container, it is overwritten.</p>
</div>
<p>See <a href="../tips/BuildArtifactsOwnedByRoot.html">this page</a> for more information on the effects of this option and why it is necessary.</p>
<h2 id="setup_commands"><code>setup_commands</code><a class="headerlink" href="#setup_commands" title="Permanent link">&para;</a></h2>
<p>List of commands to run inside the container after it has become healthy but before dependent containers start.</p>
<ul>
<li>
<p><code>command</code> The command to run. <strong>Required.</strong></p>
<p>This command is run in a similar way to the container's <a href="#command"><code>command</code></a>, so the same limitations apply to using shell syntax such as <code>&amp;&amp;</code>.</p>
</li>
<li>
<p><code>working_directory</code> The working directory to use for the command.</p>
<p>If no working directory is provided, <a href="#working_directory"><code>working_directory</code></a> is used if it is set, otherwise the image's default working directory is used.
If this container is used as the task container and the task overrides the default working directory, that override is ignored when running setup commands.</p>
</li>
</ul>
<p>The command will inherit the same environment variables as the container's <code>command</code> (including any specified on the task if this is the task container), runs as the
same <a href="#run_as_current_user">user and group</a> as the container's <code>command</code> and inherits the same settings for <a href="#privileged">privileged status</a> and
<a href="#capabilities_to_add-and-capabilities_to_drop">capabilities</a>.</p>
<p>See <a href="../TaskLifecycle.html">the task lifecycle</a> for more information on the effects of this option.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is recommended that you try to include any setup work in your image's Dockerfile wherever possible (and not use setup commands), as setup commands must be
run every time the container starts whereas commands included in your image's Dockerfile only run when the image needs to be built.</p>
</div>
<h2 id="privileged"><code>privileged</code><a class="headerlink" href="#privileged" title="Permanent link">&para;</a></h2>
<p>Set to <code>true</code> to run the container in <a href="https://docs.docker.com/engine/reference/commandline/run/#full-container-capabilities---privileged">privileged mode</a>.</p>
<p>See also <a href="#capabilities_to_add-and-capabilities_to_drop"><code>capabilities_to_add</code> and <code>capabilities_to_drop</code></a>.</p>
<h2 id="capabilities_to_add-and-capabilities_to_drop"><code>capabilities_to_add</code> and <code>capabilities_to_drop</code><a class="headerlink" href="#capabilities_to_add-and-capabilities_to_drop" title="Permanent link">&para;</a></h2>
<p>List of <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> to add or drop for the container.</p>
<p>This is equivalent to passing <a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities"><code>--cap-add</code> or <code>--cap-drop</code></a> to <code>docker run</code>.</p>
<h2 id="enable_init_process"><code>enable_init_process</code><a class="headerlink" href="#enable_init_process" title="Permanent link">&para;</a></h2>
<p>Set to <code>true</code> to pass the <a href="https://docs.docker.com/engine/reference/run/#specify-an-init-process"><code>--init</code></a> flag when running the container.
This creates the container with a simple PID 1 process to handle the responsibilities of the init system, which is required for some applications to behave correctly.</p>
<p><a href="https://engineeringblog.yelp.com/2016/01/dumb-init-an-init-for-docker.html">Read this article</a> if you're interested in more information about the behaviour
of different processes running as PID 1 and why this flag was introduced.</p>
<h2 id="additional_hostnames"><code>additional_hostnames</code><a class="headerlink" href="#additional_hostnames" title="Permanent link">&para;</a></h2>
<p>List of hostnames to associate with this container, in addition to the default hostname (the name of the container).</p>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>For more examples and real-world scenarios, take a look at the <a href="../SampleProjects.html">sample projects</a>.</p>
<h3 id="minimal-configuration-with-existing-image">Minimal configuration with existing image<a class="headerlink" href="#minimal-configuration-with-existing-image" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">openjdk:8u141-jdk</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>openjdk:8u141-jdk</code> image.</p>
<p>If the image has not already been pulled, batect will pull it before starting the container.</p>
<h3 id="minimal-configuration-with-dockerfile">Minimal configuration with Dockerfile<a class="headerlink" href="#minimal-configuration-with-dockerfile" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">build_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.batect/build-env</span>
</pre></div>

<p>Running the container <code>build-env</code> will first build the Dockerfile in the <code>.batect/build-env</code> directory, then run the resulting image.</p>
<p>The <a href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#build-cache">Docker build cache</a> is used during the build process,
so if the image definition has not changed since the last build, the image will not be rebuilt, saving time.</p>
<h3 id="container-with-custom-command">Container with custom command<a class="headerlink" href="#container-with-custom-command" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">echo &#39;Hello world&#39;</span>
</pre></div>

<p>Running the container <code>build-env</code> will run the command <code>echo 'Hello world'</code>, and not the default command specified in the <code>ruby:2.4.3</code> image.</p>
<p>This command could, however, be overridden by specifying a <a href="Tasks.html#run"><code>command</code> at the task level</a>.</p>
<h3 id="container-with-environment-variables">Container with environment variables<a class="headerlink" href="#container-with-environment-variables" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">environment</span><span class="p">:</span>
      <span class="nt">COUNTRY</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Australia</span>
      <span class="nt">SUPER_SECRET_VALUE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">$SECRET_PASSWORD</span>
      <span class="nt">ANOTHER_SECRET_VALUE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${SECRET_PASSWORD}</span>
      <span class="nt">OPTIMISATION_LEVEL</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">${HOST_OPTIMISATION_LEVEL:-none}</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>ruby:2.4.3</code> image with the following environment variables:</p>
<ul>
<li>
<p>The environment variable <code>COUNTRY</code> will have value <code>Australia</code>.</p>
</li>
<li>
<p>The environment variables <code>SUPER_SECRET_VALUE</code> and <code>ANOTHER_SECRET_VALUE</code> will have the value of the <code>SECRET_PASSWORD</code> environment variable on
  the host. (So, for example, if <code>SECRET_PASSWORD</code> is <code>abc123</code> on the host, then <code>SUPER_SECRET_VALUE</code> will have the value <code>abc123</code> in the container.)</p>
<p>If <code>SECRET_PASSWORD</code> is not set on the host, batect will show an error message and not start the task.</p>
</li>
<li>
<p>The environment variable <code>OPTIMISATION_LEVEL</code> will have the value of the <code>HOST_OPTIMISATION_LEVEL</code> environment variable on the host.</p>
<p>If <code>HOST_OPTIMISATION_LEVEL</code> is not set on the host, then <code>OPTIMISATION_LEVEL</code> will have the value <code>none</code> in the container.</p>
</li>
</ul>
<p>These environment variables could be overridden (and added to) with <a href="Tasks.html#run"><code>environment</code> at the task level</a>.</p>
<h3 id="container-with-working-directory">Container with working directory<a class="headerlink" href="#container-with-working-directory" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">working_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/somewhere</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>ruby:2.4.3</code> image with the working directory set to <code>/somewhere</code>.</p>
<h3 id="container-with-volume-mounts">Container with volume mounts<a class="headerlink" href="#container-with-volume-mounts" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
        <span class="nt">options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cached</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>ruby:2.4.3</code> image, with the directory containing the batect configuration file
mounted into the container at <code>/code</code>.</p>
<p>For example, if the batect configuration file is on the host at <code>/home/alice/code/my-project/batect.yml</code>, then <code>/home/alice/code/my-project</code> will be
available inside the container at <code>/code</code>.</p>
<p>See <a href="../tips/Performance.html#io-performance">this page</a> for more information on why using <code>cached</code> volume mounts may be worthwhile.</p>
<h3 id="container-with-ports">Container with ports<a class="headerlink" href="#container-with-ports" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">123</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">456</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>ruby:2.4.3</code> image, with the port 123 on the host mapped to port 456 inside the
container. For example, this means that if a web server is listening on port 456 within the container, it can be accessed from the host at <code>http://localhost:123</code>.</p>
<p>The Dockerfile for the <code>ruby:2.4.3</code> image does not need to contain an <code>EXPOSE</code> instruction for port 456.</p>
<p>Note that this does not affect how containers launched by batect as part of the same task access ports used by each other, just how they're exposed to the host.
Any container started as part of a task will be able to access any port on any other container at the address <code>container_name:container_port</code>. For example,
if a process running in another container wants to access the application running on port 456 in the <code>build-env</code> container, it would access it at <code>build-env:456</code>,
not <code>build-env:123</code>.</p>
<h3 id="container-with-dependencies">Container with dependencies<a class="headerlink" href="#container-with-dependencies" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">application</span><span class="p">:</span>
    <span class="nt">build_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.batect/application</span>
    <span class="nt">dependencies</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">database</span>

  <span class="nt">database</span><span class="p">:</span>
    <span class="nt">build_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.batect/database</span>
</pre></div>

<p>Running the container <code>application</code> will first run the <code>database</code> container and <a href="../tips/WaitingForDependenciesToBeReady.html">wait for it to become healthy</a>
before starting the <code>application</code> container.</p>
<h3 id="container-that-runs-as-the-current-user">Container that runs as the current user<a class="headerlink" href="#container-that-runs-as-the-current-user" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ruby:2.4.3</span>
    <span class="nt">run_as_current_user</span><span class="p">:</span>
      <span class="nt">enabled</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
      <span class="nt">home_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/container-user</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>ruby:2.4.3</code> image with <a href="../tips/BuildArtifactsOwnedByRoot.html">run as current user mode</a>
enabled.</p>
<h3 id="container-that-runs-with-dockers-default-init-process-enabled">Container that runs with Docker's default init process enabled<a class="headerlink" href="#container-that-runs-with-dockers-default-init-process-enabled" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">build-env</span><span class="p">:</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">node:10.10.0-alpine</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">local</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
        <span class="nt">container</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/code</span>
        <span class="nt">options</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">cached</span>
    <span class="nt">enable_init_process</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>

<p>Running the container <code>build-env</code> will launch a container that uses the <code>node:10.10.0-alpine</code> image with Docker's default init process as PID 1.</p>
<h3 id="container-that-runs-a-setup-command-after-starting">Container that runs a setup command after starting<a class="headerlink" href="#container-that-runs-a-setup-command-after-starting" title="Permanent link">&para;</a></h3>
<div class="codehilite"><pre><span></span><span class="nt">containers</span><span class="p">:</span>
  <span class="nt">database</span><span class="p">:</span>
    <span class="nt">build_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.batect/database</span>
    <span class="nt">setup_commands</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./apply-migrations.sh</span>

  <span class="nt">application</span><span class="p">:</span>
    <span class="nt">build_directory</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.batect/application</span>
    <span class="nt">dependencies</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">database</span>
</pre></div>

<p>Running the container <code>application</code> will first build the images for both the <code>database</code> and <code>application</code> containers.</p>
<p>Once the image for <code>database</code> is ready, <code>database</code> will start and launch the command specified in the Dockerfile, then batect will wait for the container to report as healthy.
Once <code>database</code> reports as healthy, it will run <code>./apply-migrations.sh</code> and wait for it to finish before then starting <code>application</code>.</p>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="ConfigVariables.html" title="Config Variables" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Config Variables
              </span>
            </div>
          </a>
        
        
          <a href="Tasks.html" title="Tasks" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tasks
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017-2020 Charles Korn.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/batect/batect" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://spectrum.chat/batect" class="md-footer-social__link fa fa-comments"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.808e90bb.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="../assets/3rdparty/asciinema-player.js"></script>
      
    
  </body>
</html>